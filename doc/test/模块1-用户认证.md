# æ¨¡å—1: ç”¨æˆ·è®¤è¯ APIæµ‹è¯•è®°å½•

> å…±4ä¸ªAPI | æœ€åæµ‹è¯•ï¼š2026-02-03

---

## APIåˆ—è¡¨

| åºå· | API | è¯´æ˜ | è®¤è¯è¦æ±‚ | çŠ¶æ€ |
|------|-----|------|----------|------|
| 1.1 | POST /api/auth/login | ç”¨æˆ·ç™»å½• | ğŸ”“ å…¬å¼€ | âœ… |
| 1.2 | POST /api/auth/logout | ç”¨æˆ·ç™»å‡º | ğŸ”’ éœ€è®¤è¯ | âœ… |
| 1.3 | GET /api/auth/me | è·å–å½“å‰ç”¨æˆ· | ğŸ”’ éœ€è®¤è¯ | âœ… |
| 1.4 | POST /api/auth/change-password | ä¿®æ”¹å¯†ç  | ğŸ”’ éœ€è®¤è¯ | âœ… |

---

## 1.1 POST /api/auth/login - ç”¨æˆ·ç™»å½•

### åŸºæœ¬ä¿¡æ¯

| é¡¹ | å€¼ |
|-----|-----|
| è®¤è¯è¦æ±‚ | ğŸ”“ å…¬å¼€ |
| å‰ç½®æ¡ä»¶ | æ—  |

### è¯·æ±‚æ ¼å¼

```http
POST /api/auth/login
Content-Type: application/json

{
  "username": "string (å¿…å¡«, ç”¨æˆ·å)",
  "password": "string (å¿…å¡«, å¯†ç )"
}
```

### å“åº”æ ¼å¼

**æˆåŠŸå“åº” (200):**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "token": "eyJhbGciOiJIUzUxMiJ9...",
    "user": {
      "id": 1,
      "username": "admin",
      "role": "admin",
      "name": "ç³»ç»Ÿç®¡ç†å‘˜"
    }
  },
  "timestamp": 1706947200000
}
```

### æµ‹è¯•ç”¨ä¾‹

| åºå· | æµ‹è¯•åœºæ™¯ | è¯·æ±‚å…¥å‚ | é¢„æœŸHTTPçŠ¶æ€ç  | å®é™…ç»“æœ | çŠ¶æ€ |
|------|----------|----------|----------------|----------|------|
| 1 | æ­£å¸¸ç™»å½• | `{"username":"admin","password":"admin123"}` | 200 | è¿”å›token | âœ… |
| 2 | ç”¨æˆ·åä¸ºç©º | `{"username":"","password":"admin123"}` | 400 | å‚æ•°æ ¡éªŒå¤±è´¥ | âœ… |
| 3 | å¯†ç ä¸ºç©º | `{"username":"admin","password":""}` | 400 | å‚æ•°æ ¡éªŒå¤±è´¥ | âœ… |
| 4 | ç”¨æˆ·åä¸å­˜åœ¨ | `{"username":"notexist","password":"123456"}` | 401 | ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ | âœ… |
| 5 | å¯†ç é”™è¯¯ | `{"username":"admin","password":"wrongpwd"}` | 401 | ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ | âœ… |
| 6 | SQLæ³¨å…¥æµ‹è¯• | `{"username":"admin' OR '1'='1","password":"x"}` | 401 | æ‹’ç»ï¼Œæ— æ³¨å…¥ | âœ… |
| 7 | è¶…é•¿ç”¨æˆ·å | `{"username":"a*200","password":"x"}` | 401 | æ­£ç¡®æ‹’ç» | âœ… |
| 8 | ç‰¹æ®Šå­—ç¬¦ | `{"username":"<script>alert(1)</script>","password":"x"}` | 401 | å®‰å…¨å¤„ç† | âœ… |

---

## 1.2 POST /api/auth/logout - ç”¨æˆ·ç™»å‡º

### åŸºæœ¬ä¿¡æ¯

| é¡¹ | å€¼ |
|-----|-----|
| è®¤è¯è¦æ±‚ | ğŸ”’ éœ€è®¤è¯ |
| å‰ç½®æ¡ä»¶ | éœ€å…ˆè°ƒç”¨ç™»å½•APIè·å–Token |

### è¯·æ±‚æ ¼å¼

```http
POST /api/auth/logout
Authorization: Bearer <TOKEN>
```

### æµ‹è¯•ç”¨ä¾‹

| åºå· | æµ‹è¯•åœºæ™¯ | è¯·æ±‚Header | é¢„æœŸHTTPçŠ¶æ€ç  | å®é™…ç»“æœ | çŠ¶æ€ |
|------|----------|------------|----------------|----------|------|
| 1 | æ­£å¸¸ç™»å‡º | Authorization: Bearer <æœ‰æ•ˆToken> | 200 | æˆåŠŸ | âœ… |
| 2 | æ— Token | æ— Authorizationå¤´ | 403 | æ‹’ç»è®¿é—® | âœ… |

---

## 1.3 GET /api/auth/me - è·å–å½“å‰ç”¨æˆ·

### åŸºæœ¬ä¿¡æ¯

| é¡¹ | å€¼ |
|-----|-----|
| è®¤è¯è¦æ±‚ | ğŸ”’ éœ€è®¤è¯ |
| å‰ç½®æ¡ä»¶ | éœ€å…ˆè°ƒç”¨ç™»å½•APIè·å–Token |

### è¯·æ±‚æ ¼å¼

```http
GET /api/auth/me
Authorization: Bearer <TOKEN>
```

### å“åº”æ ¼å¼

**æˆåŠŸå“åº” (200):**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "username": "admin",
    "role": "admin",
    "name": "ç³»ç»Ÿç®¡ç†å‘˜",
    "phone": "13800000000",
    "email": "admin@tricenter.com",
    "permissions": [
      "system:manage",
      "user:manage",
      "enterprise:manage",
      "enterprise:delete",
      "enterprise:export",
      "enterprise:import",
      "followup:manage",
      "dictionary:manage"
    ]
  }
}
```

### æµ‹è¯•ç”¨ä¾‹

| åºå· | æµ‹è¯•åœºæ™¯ | è¯·æ±‚Header | é¢„æœŸHTTPçŠ¶æ€ç  | å®é™…ç»“æœ | çŠ¶æ€ |
|------|----------|------------|----------------|----------|------|
| 1 | æ­£å¸¸è·å– | Authorization: Bearer <æœ‰æ•ˆToken> | 200 | è¿”å›ç”¨æˆ·ä¿¡æ¯ | âœ… |
| 2 | æ— Token | æ— Authorizationå¤´ | 403 | æ‹’ç»è®¿é—® | âœ… |
| 3 | æ— æ•ˆToken | Authorization: Bearer invalid | 401/403 | Tokenæ— æ•ˆ | âœ… |

---

## 1.4 POST /api/auth/change-password - ä¿®æ”¹å¯†ç 

### åŸºæœ¬ä¿¡æ¯

| é¡¹ | å€¼ |
|-----|-----|
| è®¤è¯è¦æ±‚ | ğŸ”’ éœ€è®¤è¯ |
| å‰ç½®æ¡ä»¶ | éœ€å…ˆè°ƒç”¨ç™»å½•APIè·å–Token |

### è¯·æ±‚æ ¼å¼

```http
POST /api/auth/change-password
Authorization: Bearer <TOKEN>
Content-Type: application/json

{
  "oldPassword": "string (å¿…å¡«, åŸå¯†ç )",
  "newPassword": "string (å¿…å¡«, æ–°å¯†ç , æœ€å°‘6ä½)"
}
```

### æµ‹è¯•ç”¨ä¾‹

| åºå· | æµ‹è¯•åœºæ™¯ | è¯·æ±‚å…¥å‚ | é¢„æœŸHTTPçŠ¶æ€ç  | å®é™…ç»“æœ | çŠ¶æ€ |
|------|----------|----------|----------------|----------|------|
| 1 | åŸå¯†ç é”™è¯¯ | `{"oldPassword":"wrong","newPassword":"newpass123"}` | 400 | åŸå¯†ç é”™è¯¯ | âœ… |
| 2 | æ–°å¯†ç ä¸ºç©º | `{"oldPassword":"admin123","newPassword":""}` | 400 | å‚æ•°æ ¡éªŒå¤±è´¥ | âœ… |
| 3 | åŸå¯†ç ä¸ºç©º | `{"oldPassword":"","newPassword":"newpass123"}` | 400 | å‚æ•°æ ¡éªŒå¤±è´¥ | âœ… |
| 4 | æ–°å¯†ç è¿‡çŸ­ | `{"oldPassword":"admin123","newPassword":"123"}` | 400 | å¯†ç é•¿åº¦ä¸è¶³ | âœ… |
| 5 | æ— Token | `{"oldPassword":"x","newPassword":"y"}` | 403 | æ‹’ç»è®¿é—® | âœ… |

---

## æµ‹è¯•æ±‡æ€»

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| æ€»æµ‹è¯•ç”¨ä¾‹ | 18 |
| å·²æµ‹è¯• | 18 |
| é€šè¿‡ | 18 |
| å¤±è´¥ | 0 |
| é€šè¿‡ç‡ | 100% |

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.1 | æ›´æ–°æ—¥æœŸï¼š2026-02-03*
