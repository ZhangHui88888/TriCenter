# æ¨¡å—7ï¼šæ¼æ–—åˆ†æ APIæµ‹è¯•æ–‡æ¡£

> æµ‹è¯•æ—¥æœŸï¼š2026-02-03
> æµ‹è¯•äººå‘˜ï¼šAI Assistant
> æ¨¡å—çŠ¶æ€ï¼šâœ… å·²å®Œæˆ

---

## æ¦‚è¿°

æ¼æ–—åˆ†ææ¨¡å—æä¾›ä¼ä¸šè½¬åŒ–æ¼æ–—çš„æ•°æ®åˆ†æåŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- æ¼æ–—å„é˜¶æ®µä¼ä¸šæ•°é‡ç»Ÿè®¡
- é˜¶æ®µé—´è½¬åŒ–ç‡è®¡ç®—
- æœˆåº¦è¶‹åŠ¿åˆ†æ

---

## APIåˆ—è¡¨

| åºå· | API | è·¯å¾„ | è®¤è¯ | çŠ¶æ€ |
|------|-----|------|------|------|
| 7.1 | æ¼æ–—æ•°æ® | GET /api/funnel/data | ğŸ”’ éœ€è®¤è¯ | âœ… |
| 7.2 | è½¬åŒ–ç‡æ•°æ® | GET /api/funnel/conversion | ğŸ”’ éœ€è®¤è¯ | âœ… |
| 7.3 | è¶‹åŠ¿æ•°æ® | GET /api/funnel/trend | ğŸ”’ éœ€è®¤è¯ | âœ… |

---

## 7.1 æ¼æ–—æ•°æ®

### åŸºæœ¬ä¿¡æ¯
| é¡¹ | å€¼ |
|-----|-----|
| è·¯å¾„ | `GET /api/funnel/data` |
| è®¤è¯ | ğŸ”’ éœ€è¦Token |
| è¯´æ˜ | è·å–æ¼æ–—å„é˜¶æ®µä¼ä¸šæ•°é‡ï¼ˆä¸dashboard/funnelç›¸åŒï¼‰ |

### è¯·æ±‚æ ¼å¼
```http
GET /api/funnel/data HTTP/1.1
Host: localhost:8080
Authorization: Bearer <token>
```

### å“åº”æ ¼å¼
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "stage": "POTENTIAL",
      "name": "æ½œåœ¨ä¼ä¸š",
      "count": 156,
      "color": "#94a3b8"
    },
    {
      "stage": "NO_DEMAND",
      "name": "æ— æ˜ç¡®éœ€æ±‚",
      "count": 45,
      "color": "#fbbf24"
    },
    {
      "stage": "NO_INTENTION",
      "name": "æ²¡æœ‰åˆä½œæ„å‘",
      "count": 12,
      "color": "#ef4444"
    },
    {
      "stage": "HAS_DEMAND",
      "name": "æœ‰æ˜ç¡®éœ€æ±‚",
      "count": 65,
      "color": "#3b82f6"
    },
    {
      "stage": "SIGNED",
      "name": "å·²ç­¾çº¦",
      "count": 34,
      "color": "#8b5cf6"
    },
    {
      "stage": "SETTLED",
      "name": "å·²å…¥é©»",
      "count": 23,
      "color": "#10b981"
    },
    {
      "stage": "INCUBATING",
      "name": "é‡ç‚¹å­µåŒ–",
      "count": 8,
      "color": "#f97316"
    }
  ]
}
```

### å“åº”å­—æ®µè¯´æ˜
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| stage | string | é˜¶æ®µä»£ç  |
| name | string | é˜¶æ®µåç§° |
| count | number | ä¼ä¸šæ•°é‡ |
| color | string | æ˜¾ç¤ºé¢œè‰²ï¼ˆåå…­è¿›åˆ¶ï¼‰ |

### æµ‹è¯•ç”¨ä¾‹

| æµ‹è¯•åœºæ™¯ | å‰ç½®æ¡ä»¶ | è¯·æ±‚ | é¢„æœŸå“åº” | å®é™…ç»“æœ | çŠ¶æ€ |
|----------|----------|------|----------|----------|------|
| æ­£å¸¸è·å–æ¼æ–—æ•°æ® | å·²ç™»å½• | GET /api/funnel/data | è¿”å›7ä¸ªé˜¶æ®µæ•°æ® | è¿”å›7ä¸ªé˜¶æ®µï¼ŒPOTENTIAL:10, SIGNED:1 | âœ… |
| æ— Tokenè®¿é—® | æœªç™»å½• | GET /api/funnel/data | 401 Unauthorized | 401 | âœ… |
| æ— æ•ˆToken | Tokenè¿‡æœŸ | GET /api/funnel/data | 401 Unauthorized | 401 | âœ… |

---

## 7.2 è½¬åŒ–ç‡æ•°æ®

### åŸºæœ¬ä¿¡æ¯
| é¡¹ | å€¼ |
|-----|-----|
| è·¯å¾„ | `GET /api/funnel/conversion` |
| è®¤è¯ | ğŸ”’ éœ€è¦Token |
| è¯´æ˜ | è·å–å„é˜¶æ®µé—´çš„è½¬åŒ–æ•°é‡å’Œè½¬åŒ–ç‡ |

### è¯·æ±‚æ ¼å¼
```http
GET /api/funnel/conversion HTTP/1.1
Host: localhost:8080
Authorization: Bearer <token>
```

### å“åº”æ ¼å¼
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "from": "POTENTIAL",
      "to": "HAS_DEMAND",
      "fromName": "æ½œåœ¨ä¼ä¸š",
      "toName": "æœ‰æ˜ç¡®éœ€æ±‚",
      "count": 65,
      "rate": 41.7
    },
    {
      "from": "POTENTIAL",
      "to": "NO_DEMAND",
      "fromName": "æ½œåœ¨ä¼ä¸š",
      "toName": "æ— æ˜ç¡®éœ€æ±‚",
      "count": 45,
      "rate": 28.8
    },
    {
      "from": "NO_DEMAND",
      "to": "HAS_DEMAND",
      "fromName": "æ— æ˜ç¡®éœ€æ±‚",
      "toName": "æœ‰æ˜ç¡®éœ€æ±‚",
      "count": 12,
      "rate": 26.7
    },
    {
      "from": "NO_DEMAND",
      "to": "NO_INTENTION",
      "fromName": "æ— æ˜ç¡®éœ€æ±‚",
      "toName": "æ²¡æœ‰åˆä½œæ„å‘",
      "count": 8,
      "rate": 17.8
    },
    {
      "from": "HAS_DEMAND",
      "to": "SIGNED",
      "fromName": "æœ‰æ˜ç¡®éœ€æ±‚",
      "toName": "å·²ç­¾çº¦",
      "count": 34,
      "rate": 52.3
    },
    {
      "from": "SIGNED",
      "to": "SETTLED",
      "fromName": "å·²ç­¾çº¦",
      "toName": "å·²å…¥é©»",
      "count": 23,
      "rate": 67.6
    },
    {
      "from": "SETTLED",
      "to": "INCUBATING",
      "fromName": "å·²å…¥é©»",
      "toName": "é‡ç‚¹å­µåŒ–",
      "count": 8,
      "rate": 34.8
    }
  ]
}
```

### å“åº”å­—æ®µè¯´æ˜
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| from | string | æ¥æºé˜¶æ®µä»£ç  |
| to | string | ç›®æ ‡é˜¶æ®µä»£ç  |
| fromName | string | æ¥æºé˜¶æ®µåç§° |
| toName | string | ç›®æ ‡é˜¶æ®µåç§° |
| count | number | è½¬åŒ–æ•°é‡ |
| rate | number | è½¬åŒ–ç‡ï¼ˆç™¾åˆ†æ¯”ï¼Œä¿ç•™1ä½å°æ•°ï¼‰ |

### è½¬åŒ–è·¯å¾„è¯´æ˜
| è·¯å¾„ | è¯´æ˜ |
|------|------|
| æ½œåœ¨ä¼ä¸š â†’ æœ‰æ˜ç¡®éœ€æ±‚ | æ½œåœ¨å®¢æˆ·è½¬åŒ–ä¸ºæœ‰éœ€æ±‚å®¢æˆ· |
| æ½œåœ¨ä¼ä¸š â†’ æ— æ˜ç¡®éœ€æ±‚ | æ½œåœ¨å®¢æˆ·æš‚æ— æ˜ç¡®éœ€æ±‚ |
| æ— æ˜ç¡®éœ€æ±‚ â†’ æœ‰æ˜ç¡®éœ€æ±‚ | éœ€æ±‚æŒ–æ˜æˆåŠŸ |
| æ— æ˜ç¡®éœ€æ±‚ â†’ æ²¡æœ‰åˆä½œæ„å‘ | å®¢æˆ·æµå¤± |
| æœ‰æ˜ç¡®éœ€æ±‚ â†’ å·²ç­¾çº¦ | ç­¾çº¦è½¬åŒ– |
| å·²ç­¾çº¦ â†’ å·²å…¥é©» | å…¥é©»è½¬åŒ– |
| å·²å…¥é©» â†’ é‡ç‚¹å­µåŒ– | å­µåŒ–å‡çº§ |

### æµ‹è¯•ç”¨ä¾‹

| æµ‹è¯•åœºæ™¯ | å‰ç½®æ¡ä»¶ | è¯·æ±‚ | é¢„æœŸå“åº” | å®é™…ç»“æœ | çŠ¶æ€ |
|----------|----------|------|----------|----------|------|
| æ­£å¸¸è·å–è½¬åŒ–ç‡ | å·²ç™»å½• | GET /api/funnel/conversion | è¿”å›7æ¡è½¬åŒ–è·¯å¾„æ•°æ® | è¿”å›7æ¡è·¯å¾„ï¼Œå«è½¬åŒ–æ•°é‡å’Œè½¬åŒ–ç‡ | âœ… |
| æ— Tokenè®¿é—® | æœªç™»å½• | GET /api/funnel/conversion | 401 Unauthorized | 401 | âœ… |

---

## 7.3 è¶‹åŠ¿æ•°æ®

### åŸºæœ¬ä¿¡æ¯
| é¡¹ | å€¼ |
|-----|-----|
| è·¯å¾„ | `GET /api/funnel/trend` |
| è®¤è¯ | ğŸ”’ éœ€è¦Token |
| è¯´æ˜ | è·å–å„é˜¶æ®µä¼ä¸šæ•°é‡çš„æœˆåº¦è¶‹åŠ¿ |

### è¯·æ±‚å‚æ•°
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| startDate | string | å¦ | å¼€å§‹æ—¥æœŸï¼ˆæ ¼å¼ï¼šyyyy-MM-ddï¼‰ï¼Œé»˜è®¤6ä¸ªæœˆå‰ |
| endDate | string | å¦ | ç»“æŸæ—¥æœŸï¼ˆæ ¼å¼ï¼šyyyy-MM-ddï¼‰ï¼Œé»˜è®¤å½“å‰æ—¥æœŸ |

### è¯·æ±‚æ ¼å¼
```http
GET /api/funnel/trend?startDate=2025-08-01&endDate=2026-02-03 HTTP/1.1
Host: localhost:8080
Authorization: Bearer <token>
```

### å“åº”æ ¼å¼
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "month": "2025-08",
      "potential": 120,
      "hasDemand": 42,
      "signed": 18,
      "settled": 12,
      "incubating": 3
    },
    {
      "month": "2025-09",
      "potential": 132,
      "hasDemand": 48,
      "signed": 22,
      "settled": 14,
      "incubating": 4
    },
    {
      "month": "2025-10",
      "potential": 141,
      "hasDemand": 52,
      "signed": 25,
      "settled": 16,
      "incubating": 5
    },
    {
      "month": "2025-11",
      "potential": 148,
      "hasDemand": 58,
      "signed": 28,
      "settled": 18,
      "incubating": 6
    },
    {
      "month": "2025-12",
      "potential": 152,
      "hasDemand": 62,
      "signed": 31,
      "settled": 20,
      "incubating": 7
    },
    {
      "month": "2026-01",
      "potential": 156,
      "hasDemand": 65,
      "signed": 34,
      "settled": 23,
      "incubating": 8
    }
  ]
}
```

### å“åº”å­—æ®µè¯´æ˜
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| month | string | æœˆä»½ï¼ˆæ ¼å¼ï¼šYYYY-MMï¼‰ |
| potential | number | æ½œåœ¨ä¼ä¸šæ•° |
| hasDemand | number | æœ‰æ˜ç¡®éœ€æ±‚æ•° |
| signed | number | å·²ç­¾çº¦æ•° |
| settled | number | å·²å…¥é©»æ•° |
| incubating | number | é‡ç‚¹å­µåŒ–æ•° |

### æµ‹è¯•ç”¨ä¾‹

| æµ‹è¯•åœºæ™¯ | å‰ç½®æ¡ä»¶ | è¯·æ±‚ | é¢„æœŸå“åº” | å®é™…ç»“æœ | çŠ¶æ€ |
|----------|----------|------|----------|----------|------|
| é»˜è®¤è·å–è¶‹åŠ¿ï¼ˆ6ä¸ªæœˆï¼‰ | å·²ç™»å½• | GET /api/funnel/trend | è¿”å›6ä¸ªæœˆæ•°æ® | è¿”å›6ä¸ªæœˆæ•°æ®ï¼ˆ2025-09è‡³2026-02ï¼‰ | âœ… |
| æŒ‡å®šæ—¥æœŸèŒƒå›´ | å·²ç™»å½• | GET /api/funnel/trend?startDate=2025-10-01&endDate=2026-01-31 | è¿”å›4ä¸ªæœˆæ•°æ® | è¿”å›4ä¸ªæœˆæ•°æ® | âœ… |
| æ— Tokenè®¿é—® | æœªç™»å½• | GET /api/funnel/trend | 401 Unauthorized | 401 | âœ… |

---

## é—®é¢˜è®°å½•

| åºå· | é—®é¢˜æè¿° | å‘ç°æ—¥æœŸ | çŠ¶æ€ | è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|------|----------|
| - | - | - | - | - |

---

## æµ‹è¯•æ€»ç»“

- æ¨¡å—7å…±3ä¸ªAPIï¼Œå…¨éƒ¨å¼€å‘å®Œæˆ
- æ¼æ–—æ•°æ®APIä¸Dashboardæ¨¡å—çš„funnel APIåŠŸèƒ½ç›¸åŒï¼Œå¤ç”¨ç›¸åŒé€»è¾‘
- è½¬åŒ–ç‡åŸºäºé˜¶æ®µå˜æ›´æ—¥å¿—ï¼ˆstage_change_logsï¼‰è¡¨è®¡ç®—
- è¶‹åŠ¿æ•°æ®é»˜è®¤è¿”å›æœ€è¿‘6ä¸ªæœˆçš„æœˆåº¦ç»Ÿè®¡

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0 | åˆ›å»ºæ—¥æœŸï¼š2026-02-03*
