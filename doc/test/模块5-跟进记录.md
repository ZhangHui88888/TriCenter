# æ¨¡å—5: è·Ÿè¿›è®°å½• API æµ‹è¯•æ–‡æ¡£

> æµ‹è¯•æ—¥æœŸï¼š2026-02-03
> æµ‹è¯•äººå‘˜ï¼šAI Assistant
> æµ‹è¯•çŠ¶æ€ï¼šâ¬œ å¾…æµ‹è¯•

---

## æµ‹è¯•æ¦‚è§ˆ

| API | è·¯å¾„ | è®¤è¯ | çŠ¶æ€ |
|-----|------|------|------|
| 5.1 è·Ÿè¿›è®°å½•åˆ—è¡¨ | GET /api/follow-ups | ğŸ”’ éœ€è®¤è¯ | â¬œ å¾…æµ‹è¯• |
| 5.2 æ–°å¢è·Ÿè¿›è®°å½• | POST /api/follow-ups | ğŸ”’ éœ€è®¤è¯ | â¬œ å¾…æµ‹è¯• |
| 5.3 ç¼–è¾‘è·Ÿè¿›è®°å½• | PUT /api/follow-ups/:id | ğŸ”’ éœ€è®¤è¯ | â¬œ å¾…æµ‹è¯• |
| 5.4 åˆ é™¤è·Ÿè¿›è®°å½• | DELETE /api/follow-ups/:id | ğŸ”’ éœ€è®¤è¯ | â¬œ å¾…æµ‹è¯• |
| 5.5 è·Ÿè¿›ç»Ÿè®¡ | GET /api/follow-ups/stats | ğŸ”’ éœ€è®¤è¯ | â¬œ å¾…æµ‹è¯• |
| é™„åŠ  è·å–ä¼ä¸šè·Ÿè¿›è®°å½• | GET /api/enterprises/:id/follow-ups | ğŸ”’ éœ€è®¤è¯ | â¬œ å¾…æµ‹è¯• |

---

## å‰ç½®æ¡ä»¶

### 1. ç™»å½•è·å–Token

**è¯·æ±‚:**
```http
POST /api/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}
```

**å“åº”:**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "token": "eyJhbGciOiJIUzUxMiJ9...",
    "user": {
      "id": 1,
      "username": "admin",
      "name": "ç®¡ç†å‘˜",
      "role": "admin"
    }
  }
}
```

### 2. åˆ›å»ºæµ‹è¯•ä¼ä¸š

**è¯·æ±‚:**
```http
POST /api/enterprises
Authorization: Bearer <token>
Content-Type: application/json

{
  "name": "è·Ÿè¿›æµ‹è¯•ä¼ä¸š",
  "district": "æ­¦è¿›åŒº",
  "enterpriseType": "ç”Ÿäº§å‹"
}
```

---

## API 5.1 è·Ÿè¿›è®°å½•åˆ—è¡¨

### è¯·æ±‚æ ¼å¼

```http
GET /api/follow-ups?keyword=&type=&enterpriseId=&page=1&pageSize=10
Authorization: Bearer <token>
```

### å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| keyword | string | å¦ | å…³é”®è¯ï¼ˆæœç´¢è·Ÿè¿›å†…å®¹ï¼‰ |
| type | string | å¦ | è·Ÿè¿›ç±»å‹ï¼šç”µè¯/è§†é¢‘/æ‹œè®¿/ä¼šè®® |
| enterpriseId | number | å¦ | ä¼ä¸šID |
| page | number | å¦ | é¡µç ï¼Œé»˜è®¤1 |
| pageSize | number | å¦ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤10 |

### å“åº”æ ¼å¼

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "enterpriseId": 1,
        "enterpriseName": "æµ‹è¯•ä¼ä¸š",
        "followDate": "2026-02-03",
        "followerName": "ç®¡ç†å‘˜",
        "followType": "ç”µè¯",
        "content": "é¦–æ¬¡ç”µè¯æ²Ÿé€š",
        "status": "åˆæ­¥æ¥è§¦",
        "nextPlan": "ä¸‹å‘¨æ‹œè®¿",
        "stageFrom": "POTENTIAL",
        "stageTo": "HAS_DEMAND",
        "createdAt": "2026-02-03T10:00:00"
      }
    ],
    "total": 1,
    "page": 1,
    "pageSize": 10
  }
}
```

### æµ‹è¯•ç”¨ä¾‹

| åœºæ™¯ | è¯·æ±‚å…¥å‚ | é¢„æœŸå“åº” | å®é™…ç»“æœ | çŠ¶æ€ |
|------|----------|----------|----------|------|
| è·å–å…¨éƒ¨åˆ—è¡¨ | page=1&pageSize=10 | è¿”å›åˆ†é¡µåˆ—è¡¨ | | â¬œ |
| æŒ‰ä¼ä¸šç­›é€‰ | enterpriseId=1 | è¿”å›è¯¥ä¼ä¸šçš„è·Ÿè¿›è®°å½• | | â¬œ |
| æŒ‰ç±»å‹ç­›é€‰ | type=ç”µè¯ | è¿”å›ç”µè¯ç±»å‹çš„è®°å½• | | â¬œ |
| å…³é”®è¯æœç´¢ | keyword=æ²Ÿé€š | è¿”å›å†…å®¹åŒ…å«"æ²Ÿé€š"çš„è®°å½• | | â¬œ |
| æ— Tokenè®¿é—® | ä¸å¸¦Authorization | 401 æœªæˆæƒ | | â¬œ |

---

## API 5.2 æ–°å¢è·Ÿè¿›è®°å½•

### è¯·æ±‚æ ¼å¼

```http
POST /api/follow-ups
Authorization: Bearer <token>
Content-Type: application/json

{
  "enterpriseId": 1,
  "followType": "ç”µè¯",
  "followDate": "2026-02-03",
  "content": "é¦–æ¬¡ç”µè¯æ²Ÿé€šï¼Œäº†è§£ä¼ä¸šåŸºæœ¬æƒ…å†µ",
  "status": "åˆæ­¥æ¥è§¦",
  "nextPlan": "ä¸‹å‘¨å®‰æ’æ‹œè®¿",
  "stageAfter": "HAS_DEMAND"
}
```

### å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| enterpriseId | number | æ˜¯ | ä¼ä¸šID |
| followType | string | æ˜¯ | è·Ÿè¿›ç±»å‹ï¼šç”µè¯/è§†é¢‘/æ‹œè®¿/ä¼šè®® |
| followDate | string | æ˜¯ | è·Ÿè¿›æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ |
| content | string | æ˜¯ | è·Ÿè¿›å†…å®¹ |
| status | string | å¦ | æ•´ä½“çŠ¶æ€ |
| nextPlan | string | å¦ | ä¸‹ä¸€æ­¥è®¡åˆ’ |
| stageAfter | string | å¦ | å˜æ›´åé˜¶æ®µï¼ˆå¡«å†™åˆ™åŒæ—¶å˜æ›´ä¼ä¸šé˜¶æ®µï¼‰ |

### å“åº”æ ¼å¼

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "enterpriseId": 1,
    "enterpriseName": "æµ‹è¯•ä¼ä¸š",
    "followDate": "2026-02-03",
    "followerName": "ç®¡ç†å‘˜",
    "followType": "ç”µè¯",
    "content": "é¦–æ¬¡ç”µè¯æ²Ÿé€šï¼Œäº†è§£ä¼ä¸šåŸºæœ¬æƒ…å†µ",
    "status": "åˆæ­¥æ¥è§¦",
    "nextPlan": "ä¸‹å‘¨å®‰æ’æ‹œè®¿",
    "stageFrom": "POTENTIAL",
    "stageTo": "HAS_DEMAND",
    "createdAt": "2026-02-03T10:00:00"
  }
}
```

### æµ‹è¯•ç”¨ä¾‹

| åœºæ™¯ | è¯·æ±‚å…¥å‚ | é¢„æœŸå“åº” | å®é™…ç»“æœ | çŠ¶æ€ |
|------|----------|----------|----------|------|
| æ­£å¸¸æ–°å¢ | å®Œæ•´å‚æ•° | 201 åˆ›å»ºæˆåŠŸ | | â¬œ |
| åŒæ—¶å˜æ›´é˜¶æ®µ | åŒ…å«stageAfter | åˆ›å»ºæˆåŠŸï¼Œä¼ä¸šé˜¶æ®µå˜æ›´ | | â¬œ |
| ç¼ºå°‘ä¼ä¸šID | enterpriseIdä¸ºç©º | 400 å‚æ•°é”™è¯¯ | | â¬œ |
| ç¼ºå°‘è·Ÿè¿›ç±»å‹ | followTypeä¸ºç©º | 400 å‚æ•°é”™è¯¯ | | â¬œ |
| ç¼ºå°‘è·Ÿè¿›æ—¥æœŸ | followDateä¸ºç©º | 400 å‚æ•°é”™è¯¯ | | â¬œ |
| ç¼ºå°‘è·Ÿè¿›å†…å®¹ | contentä¸ºç©º | 400 å‚æ•°é”™è¯¯ | | â¬œ |
| ä¼ä¸šä¸å­˜åœ¨ | enterpriseId=99999 | 400 ä¼ä¸šä¸å­˜åœ¨ | | â¬œ |
| æ— Tokenè®¿é—® | ä¸å¸¦Authorization | 401 æœªæˆæƒ | | â¬œ |

---

## API 5.3 ç¼–è¾‘è·Ÿè¿›è®°å½•

### è¯·æ±‚æ ¼å¼

```http
PUT /api/follow-ups/:id
Authorization: Bearer <token>
Content-Type: application/json

{
  "followType": "æ‹œè®¿",
  "followDate": "2026-02-04",
  "content": "æ›´æ–°åçš„è·Ÿè¿›å†…å®¹",
  "status": "æœ‰åˆä½œæ„å‘",
  "nextPlan": "å‡†å¤‡åˆä½œæ–¹æ¡ˆ"
}
```

### å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| followType | string | å¦ | è·Ÿè¿›ç±»å‹ |
| followDate | string | å¦ | è·Ÿè¿›æ—¥æœŸ |
| content | string | å¦ | è·Ÿè¿›å†…å®¹ |
| status | string | å¦ | æ•´ä½“çŠ¶æ€ |
| nextPlan | string | å¦ | ä¸‹ä¸€æ­¥è®¡åˆ’ |

### å“åº”æ ¼å¼

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "enterpriseId": 1,
    "enterpriseName": "æµ‹è¯•ä¼ä¸š",
    "followDate": "2026-02-04",
    "followerName": "ç®¡ç†å‘˜",
    "followType": "æ‹œè®¿",
    "content": "æ›´æ–°åçš„è·Ÿè¿›å†…å®¹",
    "status": "æœ‰åˆä½œæ„å‘",
    "nextPlan": "å‡†å¤‡åˆä½œæ–¹æ¡ˆ",
    "stageFrom": null,
    "stageTo": null,
    "createdAt": "2026-02-03T10:00:00"
  }
}
```

### æµ‹è¯•ç”¨ä¾‹

| åœºæ™¯ | è¯·æ±‚å…¥å‚ | é¢„æœŸå“åº” | å®é™…ç»“æœ | çŠ¶æ€ |
|------|----------|----------|----------|------|
| æ­£å¸¸æ›´æ–° | éƒ¨åˆ†å­—æ®µ | 200 æ›´æ–°æˆåŠŸ | | â¬œ |
| æ›´æ–°å…¨éƒ¨å­—æ®µ | å…¨éƒ¨å­—æ®µ | 200 æ›´æ–°æˆåŠŸ | | â¬œ |
| è®°å½•ä¸å­˜åœ¨ | id=99999 | 400 è®°å½•ä¸å­˜åœ¨ | | â¬œ |
| æ— Tokenè®¿é—® | ä¸å¸¦Authorization | 401 æœªæˆæƒ | | â¬œ |

---

## API 5.4 åˆ é™¤è·Ÿè¿›è®°å½•

### è¯·æ±‚æ ¼å¼

```http
DELETE /api/follow-ups/:id
Authorization: Bearer <token>
```

### å“åº”æ ¼å¼

```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

### æµ‹è¯•ç”¨ä¾‹

| åœºæ™¯ | è¯·æ±‚å…¥å‚ | é¢„æœŸå“åº” | å®é™…ç»“æœ | çŠ¶æ€ |
|------|----------|----------|----------|------|
| æ­£å¸¸åˆ é™¤ | æœ‰æ•ˆID | 200 åˆ é™¤æˆåŠŸ | | â¬œ |
| è®°å½•ä¸å­˜åœ¨ | id=99999 | 400 è®°å½•ä¸å­˜åœ¨ | | â¬œ |
| æ— Tokenè®¿é—® | ä¸å¸¦Authorization | 401 æœªæˆæƒ | | â¬œ |

---

## API 5.5 è·Ÿè¿›ç»Ÿè®¡

### è¯·æ±‚æ ¼å¼

```http
GET /api/follow-ups/stats
Authorization: Bearer <token>
```

### å“åº”æ ¼å¼

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "monthlyCount": 10,
    "weeklyCount": 5,
    "dailyCount": 2,
    "pendingCount": 3
  }
}
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | è¯´æ˜ |
|------|------|
| monthlyCount | æœ¬æœˆè·Ÿè¿›æ•° |
| weeklyCount | æœ¬å‘¨è·Ÿè¿›æ•° |
| dailyCount | ä»Šæ—¥è·Ÿè¿›æ•° |
| pendingCount | å¾…è·Ÿè¿›ä¼ä¸šæ•°ï¼ˆè¶…è¿‡30å¤©æœªè·Ÿè¿›ï¼‰ |

### æµ‹è¯•ç”¨ä¾‹

| åœºæ™¯ | è¯·æ±‚å…¥å‚ | é¢„æœŸå“åº” | å®é™…ç»“æœ | çŠ¶æ€ |
|------|----------|----------|----------|------|
| æ­£å¸¸è·å–ç»Ÿè®¡ | æ—  | 200 è¿”å›ç»Ÿè®¡æ•°æ® | | â¬œ |
| æ— Tokenè®¿é—® | ä¸å¸¦Authorization | 401 æœªæˆæƒ | | â¬œ |

---

## é™„åŠ  API: è·å–ä¼ä¸šè·Ÿè¿›è®°å½•

### è¯·æ±‚æ ¼å¼

```http
GET /api/enterprises/:enterpriseId/follow-ups
Authorization: Bearer <token>
```

### å“åº”æ ¼å¼

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "enterpriseId": 1,
      "enterpriseName": "æµ‹è¯•ä¼ä¸š",
      "followDate": "2026-02-03",
      "followerName": "ç®¡ç†å‘˜",
      "followType": "ç”µè¯",
      "content": "é¦–æ¬¡ç”µè¯æ²Ÿé€š",
      "status": "åˆæ­¥æ¥è§¦",
      "nextPlan": "ä¸‹å‘¨æ‹œè®¿",
      "stageFrom": null,
      "stageTo": null,
      "createdAt": "2026-02-03T10:00:00"
    }
  ]
}
```

### æµ‹è¯•ç”¨ä¾‹

| åœºæ™¯ | è¯·æ±‚å…¥å‚ | é¢„æœŸå“åº” | å®é™…ç»“æœ | çŠ¶æ€ |
|------|----------|----------|----------|------|
| æ­£å¸¸è·å– | æœ‰æ•ˆä¼ä¸šID | 200 è¿”å›è·Ÿè¿›è®°å½•åˆ—è¡¨ | | â¬œ |
| ä¼ä¸šä¸å­˜åœ¨ | enterpriseId=99999 | 400 ä¼ä¸šä¸å­˜åœ¨ | | â¬œ |
| æ— Tokenè®¿é—® | ä¸å¸¦Authorization | 401 æœªæˆæƒ | | â¬œ |

---

## è¾¹ç•Œæµ‹è¯•

| æµ‹è¯•åœºæ™¯ | æµ‹è¯•æ–¹æ³• | é¢„æœŸç»“æœ | å®é™…ç»“æœ | çŠ¶æ€ |
|----------|----------|----------|----------|------|
| ç©ºå†…å®¹ | content="" | 400 å‚æ•°é”™è¯¯ | | â¬œ |
| è¶…é•¿å†…å®¹ | content=10000å­—ç¬¦ | æ­£å¸¸ä¿å­˜æˆ–æˆªæ–­ | | â¬œ |
| ç‰¹æ®Šå­—ç¬¦ | contentå«<script> | æ­£å¸¸ä¿å­˜ï¼Œä¸æ‰§è¡Œ | | â¬œ |
| SQLæ³¨å…¥ | contentå«' OR '1'='1 | æ­£å¸¸ä¿å­˜ï¼Œä¸æ‰§è¡Œ | | â¬œ |
| æ— æ•ˆæ—¥æœŸæ ¼å¼ | followDate="invalid" | 400 å‚æ•°é”™è¯¯ | | â¬œ |
| æœªæ¥æ—¥æœŸ | followDate="2030-01-01" | æ­£å¸¸ä¿å­˜ | | â¬œ |
| æ— æ•ˆè·Ÿè¿›ç±»å‹ | followType="æ— æ•ˆç±»å‹" | æ­£å¸¸ä¿å­˜ï¼ˆä¸åšæšä¸¾æ ¡éªŒï¼‰ | | â¬œ |

---

## é—®é¢˜è®°å½•

| é—®é¢˜ID | å‘ç°æ—¥æœŸ | é—®é¢˜æè¿° | ä¸¥é‡ç¨‹åº¦ | çŠ¶æ€ | è§£å†³æ–¹æ¡ˆ |
|--------|----------|----------|----------|------|----------|
| | | | | | |

---

## æµ‹è¯•è„šæœ¬

```powershell
# è¿è¡Œæµ‹è¯•è„šæœ¬
cd backend
.\test-module5-followup.ps1
```

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0 | æ›´æ–°æ—¥æœŸï¼š2026-02-03*
